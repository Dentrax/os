From 70e792105e274885ecb7c816e940e68b24136ee3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Furkan=20T=C3=BCrkal?= <furkan.turkal@chainguard.dev>
Date: Tue, 31 Oct 2023 23:46:05 +0300
Subject: [PATCH] bump six to 1.16 and m4 1.4.19
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Furkan Türkal <furkan.turkal@chainguard.dev>
---
 WORKSPACE                                     | 13 +++--
 ...01-bump-six-to-1.16-and-m4-to-1.4.19.patch | 49 +++++++++++++++++++
 2 files changed, 58 insertions(+), 4 deletions(-)
 create mode 100644 third_party/0001-bump-six-to-1.16-and-m4-to-1.4.19.patch

diff --git a/WORKSPACE b/WORKSPACE
index 9b180d0..fc665ed 100644
--- a/WORKSPACE
+++ b/WORKSPACE
@@ -43,11 +43,11 @@ http_archive(
 http_archive(
     name = "six_archive",
     urls = [
-        "http://mirror.bazel.build/pypi.python.org/packages/source/s/six/six-1.10.0.tar.gz",
-        "https://pypi.python.org/packages/source/s/six/six-1.10.0.tar.gz",
+        "http://mirror.bazel.build/pypi.python.org/packages/source/s/six/six-1.16.0.tar.gz",
+        "https://pypi.python.org/packages/source/s/six/six-1.16.0.tar.gz",
     ],
-    sha256 = "105f8d68616f8248e24bf0e9372ef04d3cc10104f1980f54d57b2ce73a5ad56a",
-    strip_prefix = "six-1.10.0",
+    sha256 = "1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926",
+    strip_prefix = "six-1.16.0",
     build_file = "//third_party:six.BUILD"
 )
 
@@ -131,6 +131,11 @@ http_archive(
     urls = ["https://github.com/google/zetasql/archive/%s.zip" % ZETASQL_COMMIT],
     strip_prefix = "zetasql-%s" % ZETASQL_COMMIT,
     sha256 = "651a768cd51627f58aa6de7039aba9ddab22f4b0450521169800555269447840",
+    patch_tool = "patch",
+    patch_args = ["-p1"],
+    patches = [
+        "//third_party:0001-bump-six-to-1.16-and-m4-to-1.4.19.patch",
+    ],
 )
 
 load("@com_google_zetasql//bazel:zetasql_deps_step_1.bzl", "zetasql_deps_step_1")
diff --git a/third_party/0001-bump-six-to-1.16-and-m4-to-1.4.19.patch b/third_party/0001-bump-six-to-1.16-and-m4-to-1.4.19.patch
new file mode 100644
index 0000000..4464c0d
--- /dev/null
+++ b/third_party/0001-bump-six-to-1.16-and-m4-to-1.4.19.patch
@@ -0,0 +1,49 @@
+From d302bc20ee4716f3472c6e4840d667d2afc2d24f Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Furkan=20T=C3=BCrkal?= <furkan.turkal@chainguard.dev>
+Date: Tue, 31 Oct 2023 23:52:49 +0300
+Subject: [PATCH] bump six to 1.16 and m4 to 1.4.19
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+Signed-off-by: Furkan Türkal <furkan.turkal@chainguard.dev>
+---
+ bazel/zetasql_deps_step_2.bzl | 14 +++++++-------
+ 1 file changed, 7 insertions(+), 7 deletions(-)
+
+diff --git a/bazel/zetasql_deps_step_2.bzl b/bazel/zetasql_deps_step_2.bzl
+index b222ac3..414a258 100644
+--- a/bazel/zetasql_deps_step_2.bzl
++++ b/bazel/zetasql_deps_step_2.bzl
+@@ -113,9 +113,9 @@ def zetasql_deps_step_2(
+         if not native.existing_rule("six_archive"):
+             http_archive(
+                 name = "six_archive",
+-                url = "https://pypi.python.org/packages/source/s/six/six-1.10.0.tar.gz",
+-                sha256 = "105f8d68616f8248e24bf0e9372ef04d3cc10104f1980f54d57b2ce73a5ad56a",
+-                strip_prefix = "six-1.10.0",
++                url = "https://pypi.python.org/packages/source/s/six/six-1.16.0.tar.gz",
++                sha256 = "1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926",
++                strip_prefix = "six-1.16.0",
+                 build_file_content = """licenses(["notice"])
+ 
+ exports_files(["LICENSE"])
+@@ -459,11 +459,11 @@ exports_files(["data"])
+             http_archive(
+                 name = "m4",
+                 build_file_content = all_content,
+-                strip_prefix = "m4-1.4.18",
+-                sha256 = "ab2633921a5cd38e48797bf5521ad259bdc4b979078034a3b790d7fec5493fab",
++                strip_prefix = "m4-1.4.19",
++                sha256 = "3be4a26d825ffdfda52a56fc43246456989a3630093cced3fbddf4771ee58a70",
+                 urls = [
+-                    "https://ftp.gnu.org/gnu/m4/m4-1.4.18.tar.gz",
+-                    "https://mirrors.kernel.org/gnu/m4/m4-1.4.18.tar.gz",
++                    "https://ftp.gnu.org/gnu/m4/m4-1.4.19.tar.gz",
++                    "https://mirrors.kernel.org/gnu/m4/m4-1.4.19.tar.gz",
+                 ],
+                 patches = ["@com_google_zetasql//bazel:m4.patch"],
+             )
+-- 
+2.39.2 (Apple Git-143)
+
-- 
2.39.2 (Apple Git-143)

